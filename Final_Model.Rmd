---
title: "Final_Model"
author: "Tyler Cobian"
date: "5/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load the packages
```{r}
library(tidyverse)
library(sensitivity)
library(deSolve)
```

```{r}
SIR <- function(time, state, parms) {
  # SIR 
  # β is the transmission rate and β*S*I represents the number of susceptible individuals that become infected per   day
  # γ is the recovery rate and γ*I γ*I is the number of infected individuals that recover per day 
  # 1/γ is the infectious period i.e. the average duration of time an individual remains infected.
  
    with(as.list(c(state, parms)),{
        # Change in Susceptibles
        dS <- - beta * S * I 
        # Change in Infected
        dI <- beta * S * I - gamma * I 
        # Change in Recovered
        dR <- gamma * I 
    return(list(c(dS, dI, dR)))
    })
}
## Set parms
## Proportion in each compartment: Susceptible 0.999999, Infected 0.001, Recovered 0
# START DATE: April 16th where around 0.1% of the CA pop. was infected by COVID 
init <- c(S = .999, I = 0.001, R = 0.0)
parms <- c(beta = 1.4247, gamma = 0.14286)
## Time frame
time <- seq(1, 90, by = 1)
## Solve using ODE
out <- ode(y = init, times = time, func = SIR, parms = parms)
## change to data frame
out <- as.data.frame(out)
## Delete time variable
out$time <- time
## Show data
head(out, 10)
## Plot
matplot(x = time, y = out, type = "l",
        xlab = "Time", ylab = "Susceptible and Recovered", main = "SIR Model",
        lwd = 1, lty = 1, bty = "l", col = 2:4)
legend(40, 0.7, c("Susceptible", "Infected", "Recovered"), pch = 1, col = 2:4, bty = "n")
```


Make data data set that accounts for 
```{r}
# set up the parameter and coefficents that will work into the rest of the data
mean_temp<- rnorm(n = 90, mean = 65, sd = 5) # normal distribution of temperature
avg_mile_day = 974219178 # averge miles driven a day in CA noramlly
weather_coeff = 100000 # coefficient of weather on averge miles driven a day in CA
shelter_coeff = 100 # coefficient of shelter strength on miles driven a day in CA
mile_emissions = 0.411 # Emissions factor of 1 mile driven 
# add mean temperature into the covid data 
out$temp<- mean_temp
# Put in a for loop for miles driven as dependant on infections_shelter and temperature
for (i in length(out$S)){
  out$miles_driven = avg_mile_day + weather_coeff * (out$temp - mean(out$temp)) - shelter_coeff * (1-shelter_strength)
}
# loop for ghg emissions
for (i in length(out$S)){
  out$ghg = out$miles_driven * mile_emissions
}
```

Sensativity Analysis #1
```{r}
```

Sensativity Analysis #2
```{r}
```




